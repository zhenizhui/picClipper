!function(){function t(){this._events={},this._onceEvents={}}var e=t.prototype;e.on=function(t,e){if(t&&e){var i=this._events[t]=this._events[t]||[];i.indexOf(e)===-1&&i.push(e)}},e.once=function(t,e){if(t&&e){this.on(t,e);(this._onceEvents[t]=this._onceEvents[t]||{})[e]=!0}},e.off=function(t,e){if(t&&e){var i=this._events[t],n=i.indexOf(e);n>-1&&i.splice(n,1)}},e.emit=function(t){for(var e=this._events[t],i=this._onceEvents[t],n=0;e[n]&&n<e.length;){var o=e[n];o(),i[e[n]]?(this.off(t,o),delete i[e[o]],n=0):n++}},"function"==typeof define?define(function(){return t}):"undefined"!=typeof module&&null!==module?module.exports=t:window.EventEmitter=t}(),function(){function t(t,e){this.el=t,this.isDrag=!1,this.containerEl=e.container,this._max={},this._x=0,this._y=0,this._marginLeft=0,this._marginTop=0,this.init()}var e=t.prototype=Object.create(EventEmitter.prototype);e.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},e.init=function(){var t=getComputedStyle(this.el).getPropertyValue("margin-left");"static"!==t&&"fixed"!==t||(this.el.style.position="relative"),this.el.addEventListener("mousedown",this)},e.bindEvent=function(){var t=["mousemove","mouseup"];t.forEach(function(t){document.addEventListener(t,this)},this),this._boundPointerEvents=t},e.unbindEvent=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(t){document.removeEventListener(t,this)},this),delete this._boundPointerEvents)},e.onmousedown=function(t){t.stopPropagation(),console.log("%c drag","background: #222; color: #bada55","mousedown"),t.target==this.el&&(this.bindEvent(),this.dragStar(t))},e.onmousemove=function(t){this.dragMove(t)},e.onmouseup=function(t){this.dragEnd(t)},e.dragStar=function(t){this.isDrag=!0,this._x=t.clientX-this.el.offsetLeft,this._y=t.clientY-this.el.offsetTop},e.dragMove=function(t){if(this.isDrag){var e=t.clientX-this._x,i=t.clientY-this._y;if(this.containerEl){var n=this.containerEl.getBoundingClientRect().left,o=this.containerEl.getBoundingClientRect().top,s=this.containerEl.getBoundingClientRect().width,l=this.containerEl.getBoundingClientRect().height,d=this.el.getBoundingClientRect().width,r=this.el.getBoundingClientRect().height,a=document.querySelector(".display"),c=""==a.style.left?0:parseInt(a.style.left),h=e+c>=n,v=e+d<=s,f=i>=o,u=i+r<=o+l;console.log("c1= "+h+"c2= "+v+"c3= "+f+"c4= "+u);h&&v&&f&&u&&(this.el.style.left=e+"px",this.el.style.top=i+"px")}else this.el.style.left=e+"px",this.el.style.top=i+"px"}},e.dragEnd=function(){this.isDrag=!1,this.unbindEvent()},"function"==typeof define?define(function(){return t}):"undefined"!=typeof module&&null!==module?module.exports=t:window.dragable=t}(),function(){function t(t){return document.querySelector(t)}function e(e){this.fileInputEl=t(e.fileInputEl),this.displayEl=t(e.displayEl),this.dragDivEl=null,this.clipperDivEl=null,this.imgObj=null}var i=e.prototype;i.init=function(){this.initDom(),this.initPic(),this.initEvent()},i.initDom=function(){this.displayEl.innerHTML='<canvas id="pic-canvas"></canvas><div class="clipper-div" id="clipperDiv" ></div>';var e=document.createElement("div");e.id="dragDiv",document.querySelector(".clipper-div").appendChild(e),e.innerHTML='<div id="dot-1" class="dot lt"></div><div id="dot-2" class="dot tm"></div><div id="dot-3" class="dot rt"></div><div id="dot-4" class="dot rm"></div><div id="dot-5" class="dot rb"></div><div id="dot-6" class="dot bm"></div><div id="dot-7" class="dot bl"></div><div id="dot-8" class="dot lm"></div>',e.style.display="none",this.dragDivEl=t("#dragDiv"),this.clipperDivEl=t("#clipperDiv")},i.initPic=function(){var e=this,i=this.fileInputEl;i.addEventListener("change",function(){if(!i&&"file"!==i.type)return void console.error("you need a input element which type is file!");var n=new FileReader;n.onload=function(i){var n=document.getElementById("pic-canvas"),o=n.getContext("2d"),s=new Image,l=t(".clipper-div");s.src=i.target.result,e.imgObj=s,s.onload=function(){o.canvas.width=s.width,o.canvas.height=s.height,o.drawImage(s,0,0),l.style.width=s.width+"px",l.style.height=s.height+"px"}},n.readAsDataURL(this.files[0])})},i.initEvent=function(){this.initDrawEvent(),this.initResize()},i.initDrawEvent=function(){function e(e){function i(t){if(console.log("document draw move"),o){var e=t.clientX-s.startX,i=t.clientY-s.startY;e=e+n.dragDivEl.offsetLeft>=d?d-n.dragDivEl.offsetLeft:e,i=i+n.dragDivEl.offsetTop>=r?r-n.dragDivEl.offsetTop:i,n.dragDivEl.style.width=e+"px",n.dragDivEl.style.height=i+"px"}}var d=parseInt(n.clipperDivEl.style.width),r=parseInt(n.clipperDivEl.style.height);console.log("clipperDivEl mousedown");var a=t("#dragDiv");a.style.display="block";for(var c=0,h=0,v=a.offsetParent;v;)c+=v.offsetLeft,h+=v.offsetTop,v=v.offsetParent;o=!0,s.startX=e.clientX,s.startY=e.clientY,n.dragDivEl.style.left=s.startX-c+"px",n.dragDivEl.style.top=s.startY-h+"px",n.dragDivEl.style.background="#fff",document.addEventListener("mousemove",i),l=i}function i(t){o=!1,document.removeEventListener("mousemove",l)}var n=this,o=!1,s={},l=null;this.clipperDivEl.addEventListener("mousedown",e),document.addEventListener("mouseup",i),new dragable(this.dragDivEl,{container:this.clipperDivEl})},i.initResize=function(){function t(t){function e(t){var e=t.clientX-n.x,o=t.clientY-n.y,s=l+e,h=d+o;switch(s=s+i.dragDivEl.offsetLeft>a?c-i.dragDivEl.offsetLeft:s,h=h+i.dragDivEl.offsetTop>c?c-i.dragDivEl.offsetTop:h,r){case"lt":break;case"tm":break;case"rt":break;case"rm":break;case"rb":i.resizeDrawDiv(s,h);break;case"bm":break;case"bl":break;case"lm":break;default:console.log("不是调整的节点")}}t.stopPropagation();var o=i.dragDivEl,l=o.offsetWidth,d=o.offsetHeight,r=t.target.classList[1],a=parseInt(i.clipperDivEl.style.width),c=parseInt(i.clipperDivEl.style.height);n.x=t.clientX,n.y=t.clientY,document.addEventListener("mousemove",e),s=e}function e(){document.removeEventListener("mousemove",s)}var i=this,n={x:0,y:0},o=document.getElementsByClassName("dot"),s=null;Array.prototype.forEach.call(o,function(i){i.addEventListener("mousedown",t),document.addEventListener("mouseup",e)})},i.resizeDrawDiv=function(e,i){var n=t("#dragDiv");n.style.width=e+"px",n.style.height=i+"px"},i.saveToNewImg=function(){var t={},e=this.imgObj,i=this.dragDivEl,n=document.createElement("canvas"),o=n.getContext("2d");t.x=parseInt(i.style.left),t.y=parseInt(i.style.top),t.width=parseInt(i.style.width),t.height=parseInt(i.style.height),n.width=t.width,n.height=t.height,o.drawImage(e,t.x,t.y,t.width,t.height,0,0,t.width,t.height),window.open(n.toDataURL("image/png"))},"function"==typeof define?define(function(){return e}):"undefined"!=typeof module&&null!==module?module.exports=e:window.Clipper=e}();